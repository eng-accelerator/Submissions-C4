version: '3.8'

services:
  devops-incident-suite:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: devops-incident-suite
    ports:
      - "8501:8501"
    environment:
      # Required
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY:-}
      
      # Optional - Slack
      - SLACK_WEBHOOK_URL=${SLACK_WEBHOOK_URL:-}
      
      # Optional - JIRA
      - JIRA_URL=${JIRA_URL:-}
      - JIRA_USERNAME=${JIRA_USERNAME:-}
      - JIRA_API_TOKEN=${JIRA_API_TOKEN:-}
      - JIRA_PROJECT_KEY=${JIRA_PROJECT_KEY:-OPS}
      
      # Optional - LLM Model
      - LLM_MODEL=${LLM_MODEL:-openai/gpt-4o}
      
      # Streamlit Configuration
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
    
    volumes:
      # Optional: Mount local directory for development
      # - .:/app
      # Mount for logs (optional)
      - incident-logs:/app/logs
    
    restart: unless-stopped
    
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

volumes:
  incident-logs:
    driver: local
